"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var JSZip=_interopDefault(require("jszip")),FileSaver=_interopDefault(require("file-saver")),escape=_interopDefault(require("lodash.escape"));const CELL_TYPE_STRING="string",CELL_TYPE_NUMBER="number",validTypes=["string","number"],MISSING_KEY_FILENAME="Zipclex config missing property filename",INVALID_TYPE_FILENAME="Zipclex filename can only be of type string",INVALID_TYPE_SHEET="Zipcelx sheet data is not of type array",INVALID_TYPE_SHEET_DATA="Zipclex sheet data childs is not of type array",INVALID_TYPE_SHEET_NAME="Zipclex sheetName can only be of type string",MISSING_SHEET_PROPERTY="Zipclex config missing property sheet or sheets",INVALID_SHEET_PROPERTY="Zipclex config cannot include both sheet and sheets properties",WARNING_INVALID_TYPE='Invalid type supplied in cell config, falling back to "string"',childValidator=e=>e.every(e=>Array.isArray(e));var validator=e=>{if(!e.filename)return console.error(MISSING_KEY_FILENAME),!1;if("string"!=typeof e.filename)return console.error(INVALID_TYPE_FILENAME),!1;if(e.sheet&&e.sheets)return console.error(INVALID_SHEET_PROPERTY),!1;if(!e.sheet&&!e.sheets)return console.error(MISSING_SHEET_PROPERTY),!1;if(e.sheet){if(!Array.isArray(e.sheet.data))return console.error(INVALID_TYPE_SHEET),!1;if(!childValidator(e.sheet.data))return console.error(INVALID_TYPE_SHEET_DATA),!1}if(e.sheets){if(!e.sheets.length>0)return console.error(INVALID_TYPE_SHEET),!1;for(let t=0;t<e.sheets.length;t+=1){if(e.sheets[t].filename&&"string"!=typeof e.sheets[t].filename)return console.error(INVALID_TYPE_SHEET_NAME),!1;if(!Array.isArray(e.sheets[t].data))return console.error(INVALID_TYPE_SHEET),!1;if(!childValidator(e.sheets[t].data))return console.error(INVALID_TYPE_SHEET_DATA),!1}}return!0};const generateColumnLetter=e=>{if("number"!=typeof e)return"";const t=Math.floor(e/26),r=String.fromCharCode(97+e%26).toUpperCase();return 0===t?r:generateColumnLetter(t-1)+r};var generatorCellNumber=(e,t)=>`${generateColumnLetter(e)}${t}`,generatorStringCell=(e,t,r)=>`<c r="${generatorCellNumber(e,r)}" t="inlineStr"><is><t>${escape(t)}</t></is></c>`,generatorNumberCell=(e,t,r)=>`<c r="${generatorCellNumber(e,r)}"><v>${t}</v></c>`,formatCell=(e,t,r)=>(-1===validTypes.indexOf(e.type)&&(console.warn(WARNING_INVALID_TYPE),e.type="string"),"string"===e.type?generatorStringCell(t,e.value,r):generatorNumberCell(t,e.value,r)),formatRow=(e,t)=>{const r=t+1,o=e.map((e,t)=>formatCell(e,t,r)).join("");return`<row r="${r}">${o}</row>`},generatorRows=e=>e.map((e,t)=>formatRow(e,t)).join(""),workbookXML='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main"><workbookPr/><sheets>{placeholder}</sheets><definedNames/><calcPr/></workbook>',workbookXMLRels='<?xml version="1.0" ?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n{placeholder}\n</Relationships>',rels='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',contentTypes='<?xml version="1.0" ?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n<Default ContentType="application/xml" Extension="xml"/>\n<Default ContentType="application/vnd.openxmlformats-package.relationships+xml" Extension="rels"/>\n{placeholder}\n<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" PartName="/xl/workbook.xml"/>\n</Types>',templateSheet='<?xml version="1.0" ?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:mv="urn:schemas-microsoft-com:mac:vml" xmlns:mx="http://schemas.microsoft.com/office/mac/excel/2008/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac" xmlns:xm="http://schemas.microsoft.com/office/excel/2006/main"><sheetData>{placeholder}</sheetData></worksheet>';const generateXMLWorksheet=e=>{const t=generatorRows(e);return templateSheet.replace("{placeholder}",t)},generateWorkbook=e=>{const t=new JSZip,r=e.sheets||[e.sheet];let o="",s="",n="";for(let e=0;e<r.length;e+=1){const a=e+1;t.file(`xl/worksheets/sheet${a}.xml`,generateXMLWorksheet(r[e].data)),o+=`<Override ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" PartName="/xl/worksheets/sheet${a}.xml"/>`,s+=`<sheet name="${r[e].sheetName||`Sheet${a}`}" sheetId="${a}" r:id="rId${a}"/>`,n+=`<Relationship Id="rId${a}" Target="worksheets/sheet${a}.xml" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet"/>`}return t.file("xl/workbook.xml",workbookXML.replace("{placeholder}",s)),t.file("xl/_rels/workbook.xml.rels",workbookXMLRels.replace("{placeholder}",n)),t.file("[Content_Types].xml",contentTypes.replace("{placeholder}",o)),t.file("_rels/.rels",rels),t};var zipcelx=e=>{if(!validator(e))throw new Error("Validation failed.");return generateWorkbook(e).generateAsync({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}).then(t=>{FileSaver.saveAs(t,`${e.filename}.xlsx`)})};exports.default=zipcelx,exports.generateXMLWorksheet=generateXMLWorksheet;
